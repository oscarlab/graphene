diff --git a/arch/x86_64/syscall_arch.h b/arch/x86_64/syscall_arch.h
index 92d5c179217b25418e257b2fd1b563abeeff6f65..75eb4fe308c4eb95251571973b8f27271b33f634 100644
--- a/arch/x86_64/syscall_arch.h
+++ b/arch/x86_64/syscall_arch.h
@@ -1,24 +1,26 @@
+#include "shim_entry_api.h"
+
 #define __SYSCALL_LL_E(x) (x)
 #define __SYSCALL_LL_O(x) (x)
 
 static __inline long __syscall0(long n)
 {
 	unsigned long ret;
-	__asm__ __volatile__ ("syscall" : "=a"(ret) : "a"(n) : "rcx", "r11", "memory");
+	__asm__ __volatile__ ("SYSCALLDB" : "=a"(ret) : "a"(n) : "rcx", "r11", "memory");
 	return ret;
 }
 
 static __inline long __syscall1(long n, long a1)
 {
 	unsigned long ret;
-	__asm__ __volatile__ ("syscall" : "=a"(ret) : "a"(n), "D"(a1) : "rcx", "r11", "memory");
+	__asm__ __volatile__ ("SYSCALLDB" : "=a"(ret) : "a"(n), "D"(a1) : "rcx", "r11", "memory");
 	return ret;
 }
 
 static __inline long __syscall2(long n, long a1, long a2)
 {
 	unsigned long ret;
-	__asm__ __volatile__ ("syscall" : "=a"(ret) : "a"(n), "D"(a1), "S"(a2)
+	__asm__ __volatile__ ("SYSCALLDB" : "=a"(ret) : "a"(n), "D"(a1), "S"(a2)
 						  : "rcx", "r11", "memory");
 	return ret;
 }
@@ -26,7 +28,7 @@ static __inline long __syscall2(long n, long a1, long a2)
 static __inline long __syscall3(long n, long a1, long a2, long a3)
 {
 	unsigned long ret;
-	__asm__ __volatile__ ("syscall" : "=a"(ret) : "a"(n), "D"(a1), "S"(a2),
+	__asm__ __volatile__ ("SYSCALLDB" : "=a"(ret) : "a"(n), "D"(a1), "S"(a2),
 						  "d"(a3) : "rcx", "r11", "memory");
 	return ret;
 }
@@ -35,7 +37,7 @@ static __inline long __syscall4(long n, long a1, long a2, long a3, long a4)
 {
 	unsigned long ret;
 	register long r10 __asm__("r10") = a4;
-	__asm__ __volatile__ ("syscall" : "=a"(ret) : "a"(n), "D"(a1), "S"(a2),
+	__asm__ __volatile__ ("SYSCALLDB" : "=a"(ret) : "a"(n), "D"(a1), "S"(a2),
 						  "d"(a3), "r"(r10): "rcx", "r11", "memory");
 	return ret;
 }
@@ -45,7 +47,7 @@ static __inline long __syscall5(long n, long a1, long a2, long a3, long a4, long
 	unsigned long ret;
 	register long r10 __asm__("r10") = a4;
 	register long r8 __asm__("r8") = a5;
-	__asm__ __volatile__ ("syscall" : "=a"(ret) : "a"(n), "D"(a1), "S"(a2),
+	__asm__ __volatile__ ("SYSCALLDB" : "=a"(ret) : "a"(n), "D"(a1), "S"(a2),
 						  "d"(a3), "r"(r10), "r"(r8) : "rcx", "r11", "memory");
 	return ret;
 }
@@ -56,7 +58,7 @@ static __inline long __syscall6(long n, long a1, long a2, long a3, long a4, long
 	register long r10 __asm__("r10") = a4;
 	register long r8 __asm__("r8") = a5;
 	register long r9 __asm__("r9") = a6;
-	__asm__ __volatile__ ("syscall" : "=a"(ret) : "a"(n), "D"(a1), "S"(a2),
+	__asm__ __volatile__ ("SYSCALLDB" : "=a"(ret) : "a"(n), "D"(a1), "S"(a2),
 						  "d"(a3), "r"(r10), "r"(r8), "r"(r9) : "rcx", "r11", "memory");
 	return ret;
 }
diff --git a/ldso/dynlink.c b/ldso/dynlink.c
index 6b868c841476a34b0bb3eea98be9611052b7b3ef..f89427f86387fb612063ed3f9c8f48a2bd776b98 100644
--- a/ldso/dynlink.c
+++ b/ldso/dynlink.c
@@ -24,6 +24,8 @@
 #include "libc.h"
 #include "dynlink.h"
 
+#include "shim_entry_api.h"
+
 #define malloc __libc_malloc
 #define calloc __libc_calloc
 #define realloc __libc_realloc
@@ -1344,6 +1346,8 @@ static void do_mips_relocs(struct dso *p, size_t *got)
 
 static void reloc_all(struct dso *p)
 {
+	shim_register_library(p->name, (unsigned long)p->base);
+
 	size_t dyn[DYN_CNT];
 	for (; p; p=p->next) {
 		if (p->relocated) continue;
diff --git a/src/process/x86_64/vfork.s b/src/process/x86_64/vfork.S
similarity index 77%
rename from src/process/x86_64/vfork.s
rename to src/process/x86_64/vfork.S
index 9114439031bebc9af6505ad4cefb385ac83002dc..3c7b1364b30c10d20df34659ab035950bbbcd00e 100644
--- a/src/process/x86_64/vfork.s
+++ b/src/process/x86_64/vfork.S
@@ -1,9 +1,11 @@
+#include "shim_entry_api.h"
+
 .global vfork
 .type vfork,@function
 vfork:
 	pop %rdx
 	mov $58,%eax
-	syscall
+	SYSCALLDB
 	push %rdx
 	mov %rax,%rdi
 	.hidden __syscall_ret
diff --git a/src/signal/x86_64/restore.s b/src/signal/x86_64/restore.S
similarity index 77%
rename from src/signal/x86_64/restore.s
rename to src/signal/x86_64/restore.S
index 27d6cf310337a9e7227a0da422d3b37c9397091d..bf5392d2b910fddd0fb29ca04c56d630f2ec2bf9 100644
--- a/src/signal/x86_64/restore.s
+++ b/src/signal/x86_64/restore.S
@@ -1,8 +1,10 @@
+#include "shim_entry_api.h"
+
 	nop
 .global __restore_rt
 .hidden __restore_rt
 .type __restore_rt,@function
 __restore_rt:
 	mov $15, %rax
-	syscall
+	SYSCALLDB
 .size __restore_rt,.-__restore_rt
diff --git a/src/thread/x86_64/__set_thread_area.s b/src/thread/x86_64/__set_thread_area.S
similarity index 80%
rename from src/thread/x86_64/__set_thread_area.s
rename to src/thread/x86_64/__set_thread_area.S
index 7347ff4dc1e12cc41815a19faa5e532d8fe53184..e30727fd0af6e4870090b049abb119ea65011dae 100644
--- a/src/thread/x86_64/__set_thread_area.s
+++ b/src/thread/x86_64/__set_thread_area.S
@@ -1,3 +1,5 @@
+#include "shim_entry_api.h"
+
 /* Copyright 2011-2012 Nicholas J. Kain, licensed under standard MIT license */
 .text
 .global __set_thread_area
@@ -7,5 +9,5 @@ __set_thread_area:
 	mov %rdi,%rsi           /* shift for syscall */
 	movl $0x1002,%edi       /* SET_FS register */
 	movl $158,%eax          /* set fs segment to */
-	syscall                 /* arch_prctl(SET_FS, arg)*/
+	SYSCALLDB               /* arch_prctl(SET_FS, arg)*/
 	ret
diff --git a/src/thread/x86_64/__unmapself.s b/src/thread/x86_64/__unmapself.S
similarity index 72%
rename from src/thread/x86_64/__unmapself.s
rename to src/thread/x86_64/__unmapself.S
index e2689e65052ce76b4639324c3bcf239f97c36eee..a5b867e8aab25175facef2f6b6fbf4df05684198 100644
--- a/src/thread/x86_64/__unmapself.s
+++ b/src/thread/x86_64/__unmapself.S
@@ -1,10 +1,12 @@
+#include "shim_entry_api.h"
+
 /* Copyright 2011-2012 Nicholas J. Kain, licensed under standard MIT license */
 .text
 .global __unmapself
 .type   __unmapself,@function
 __unmapself:
 	movl $11,%eax   /* SYS_munmap */
-	syscall         /* munmap(arg2,arg3) */
+	SYSCALLDB       /* munmap(arg2,arg3) */
 	xor %rdi,%rdi   /* exit() args: always return success */
 	movl $60,%eax   /* SYS_exit */
-	syscall         /* exit(0) */
+	SYSCALLDB       /* exit(0) */
diff --git a/src/thread/x86_64/clone.s b/src/thread/x86_64/clone.S
similarity index 87%
rename from src/thread/x86_64/clone.s
rename to src/thread/x86_64/clone.S
index 6e47bc0a37dee7157ceaf1369659891a2d7d16bb..77e0bf3113119e00f5c82e0be4f96458aa084649 100644
--- a/src/thread/x86_64/clone.s
+++ b/src/thread/x86_64/clone.S
@@ -1,3 +1,5 @@
+#include "shim_entry_api.h"
+
 .text
 .global __clone
 .hidden __clone
@@ -14,7 +16,7 @@ __clone:
 	and $-16,%rsi
 	sub $8,%rsi
 	mov %rcx,(%rsi)
-	syscall
+	SYSCALLDB
 	test %eax,%eax
 	jnz 1f
 	xor %ebp,%ebp
@@ -23,6 +25,6 @@ __clone:
 	mov %eax,%edi
 	xor %eax,%eax
 	mov $60,%al
-	syscall
+	SYSCALLDB
 	hlt
 1:	ret
diff --git a/src/thread/x86_64/syscall_cp.s b/src/thread/x86_64/syscall_cp.S
similarity index 92%
rename from src/thread/x86_64/syscall_cp.s
rename to src/thread/x86_64/syscall_cp.S
index 4f101716d4ee0cd50461f45a0da6b2edb2be3d4c..506d51a8b3c82f7fa77b221785c91b02d4bed30e 100644
--- a/src/thread/x86_64/syscall_cp.s
+++ b/src/thread/x86_64/syscall_cp.S
@@ -1,3 +1,5 @@
+#include "shim_entry_api.h"
+
 .text
 .global __cp_begin
 .hidden __cp_begin
@@ -24,7 +26,7 @@ __cp_begin:
 	mov 8(%rsp),%r8
 	mov 16(%rsp),%r9
 	mov %r11,8(%rsp)
-	syscall
+	SYSCALLDB
 __cp_end:
 	ret
 __cp_cancel:
